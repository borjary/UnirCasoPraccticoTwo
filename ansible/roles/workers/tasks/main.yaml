---

- debug:
    msg: "The CERT Hash of master is: {{ cert_hash }}"
  when: cert_hash is defined

- debug:
    msg: "The token Hash of master is: {{ token_hash }}"
  when: token_hash is defined
  
- debug:
    msg: "The IP of master is: {{ ip_master }}"
  when: ip_master is defined
  
- name: Enabls necesary ports to join uf cluster 10250
  firewalld:
    port: 10250/tcp
    permanent: true
    zone: public
    state: enabled
  become: yes
  
- name: Enable the ports necesary to join the cluster 30000 32767
  firewalld:
    port: 30000-32767/tcp
    permanent: true
    zone: public
    state: enabled
  become: yes
  
- name: Reestart the Firewalld service 
  systemd:
    name: firewalld
    state: restarted
  become: yes
  
- name: Show the join command from worker to master
  debug:
    msg: "Will execute: kubeadm join {{ ip_master }}:6443 --token {{ token_hash }} --discovery-token-ca-cert-hash sha256:{{ cert_hash }}"

- name: Join Worker to kubernetes cluster
  shell: "kubeadm join {{ ip_master }}:6443 --token {{ token_hash }} --discovery-token-ca-cert-hash sha256:{{ cert_hash }}"
  register: kubeadm_join
  become: yes
  
- name: Result of join
  debug:
    msg: "{{ kubeadm_join.stdout_lines }}"
  